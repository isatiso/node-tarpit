---
title: å¿«é€Ÿå¼€å§‹
sidebar_position: 1
hide_title: true
---

<div style={{textAlign: 'center', marginBottom: '2rem'}}>
  <img src="/img/tarpit-full.svg" alt="Tarpit Logo" style={{width: '40%', maxWidth: '300px'}} />
</div>

<div style={{textAlign: 'center', fontSize: '1.2rem', marginBottom: '2rem'}}>
ğŸ¥¦ ç®€æ´è€Œå¼ºå¤§çš„ <a href="https://www.typescriptlang.org/">TypeScript</a> DI æ¡†æ¶ï¼Œä¸“ä¸º Node.js æ‰“é€  ğŸ¥¦
</div>

{/* Metrics Badges (with numbers) */}
<div style={{textAlign: 'center', marginBottom: '1rem'}}>
  <a href="https://www.npmjs.com/package/@tarpit/core"><img src="https://img.shields.io/npm/v/@tarpit/core" alt="NPM Version" /></a>
  {' '}
  <a href="https://www.npmjs.com/package/@tarpit/core"><img src="https://img.shields.io/npm/dm/@tarpit/core" alt="Monthly Downloads" /></a>
  {' '}
  <a href="https://nodejs.org/en/"><img src="https://img.shields.io/node/v/@tarpit/core" alt="Node.js Version" /></a>
  {' '}
  <a href="https://codecov.io/gh/isatiso/node-tarpit"><img src="https://codecov.io/gh/isatiso/node-tarpit/branch/main/graph/badge.svg?token=9S3UQPNS3Y" alt="Code Coverage" /></a>
  {' '}
  <a href="https://bundlephobia.com/package/@tarpit/core"><img src="https://img.shields.io/bundlephobia/minzip/@tarpit/core" alt="Bundle Size" /></a>
  {' '}
  <a href="https://github.com/isatiso/node-tarpit/commits/main"><img src="https://img.shields.io/github/last-commit/isatiso/node-tarpit" alt="Last Commit" /></a>
</div>

{/* Status/Identity Badges (without numbers) */}
<div style={{textAlign: 'center', marginBottom: '1rem'}}>
  <a href="https://github.com/isatiso/node-tarpit/actions/workflows/ci.yml"><img src="https://img.shields.io/github/check-runs/isatiso/node-tarpit/main" alt="Build Status" /></a>
  {' '}
  <a href="https://github.com/isatiso/node-tarpit"><img src="https://img.shields.io/badge/TypeScript-007ACC?logo=typescript&logoColor=white" alt="TypeScript" /></a>
  {' '}
  <a href="https://github.com/isatiso/node-tarpit/blob/main/LICENSE"><img src="https://img.shields.io/github/license/isatiso/node-tarpit" alt="MIT License" /></a>
  {' '}
  <a href="https://lerna.js.org/"><img src="https://img.shields.io/badge/maintained%20with-lerna-cc00ff.svg" alt="Lerna" /></a>
  {' '}
  <a href="https://deepwiki.com/isatiso/node-tarpit"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki" /></a>
</div>

{/* Social Badges */}
<div style={{textAlign: 'center', marginBottom: '2rem'}}>
  <a href="https://github.com/isatiso/node-tarpit"><img src="https://img.shields.io/github/stars/isatiso/node-tarpit?style=social" alt="GitHub Stars" /></a>
  {' '}
  <a href="https://github.com/isatiso/node-tarpit/network/members"><img src="https://img.shields.io/github/forks/isatiso/node-tarpit?style=social" alt="GitHub Forks" /></a>
</div>

## ä»€ä¹ˆæ˜¯ Tarpitï¼Ÿ

Tarpit æ˜¯ä¸€ä¸ªç°ä»£çš„**ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¡†æ¶**ï¼Œä¸“é—¨ä¸º TypeScript å’Œ Node.js åº”ç”¨ç¨‹åºæ„å»ºã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å¹³å°ï¼Œç”¨äºæ„å»º**å¯é‡ç”¨**ã€**å¯æµ‹è¯•**å’Œ**å¯ç»´æŠ¤**çš„æœåŠ¡ç«¯åº”ç”¨ç¨‹åºï¼Œå…·æœ‰ç®€æ´çš„åŸºäºè£…é¥°å™¨çš„æ¶æ„ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ¯ ç±»å‹å®‰å…¨çš„ DI**ï¼šåˆ©ç”¨ TypeScript çš„ç±»å‹ç³»ç»Ÿè¿›è¡Œä¾èµ–è§£æ
- **ğŸš€ åŸºäºè£…é¥°å™¨**ï¼šä½¿ç”¨ TypeScript è£…é¥°å™¨çš„ç®€æ´ã€å£°æ˜å¼è¯­æ³•
- **ğŸ“¦ æ¨¡å—åŒ–æ¶æ„**ï¼šå†…ç½®æ”¯æŒæ¨¡å—å’Œç»„ä»¶ç»„ç»‡
- **ğŸ”§ å¯æ‰©å±•**ï¼šæ˜“äºä½¿ç”¨è‡ªå®šä¹‰æä¾›è€…å’Œæ¨¡å—è¿›è¡Œæ‰©å±•
- **âš¡ è½»é‡çº§**ï¼šä¸“æ³¨åŠŸèƒ½çš„æœ€å°å¼€é”€
- **ğŸ§ª æµ‹è¯•å‹å¥½**ï¼šä»è®¾è®¡ä¹‹åˆå°±è€ƒè™‘äº†å¯æµ‹è¯•æ€§

### æ ¸å¿ƒæ¦‚å¿µ

Tarpit çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿå›´ç»•ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µæ„å»ºï¼š

**Platformï¼ˆå¹³å°ï¼‰** - ç®¡ç†æ•´ä¸ªä¾èµ–æ³¨å…¥ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºå®¹å™¨ã€‚å®ƒåè°ƒæ¨¡å—å¯¼å…¥ï¼Œæ§åˆ¶åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä½œä¸ºæ‰€æœ‰æœåŠ¡å’Œæä¾›è€…çš„ä¸­å¤®æ³¨å†Œè¡¨ã€‚

**Providersï¼ˆæä¾›è€…ï¼‰** - å‘Šè¯‰ DI ç³»ç»Ÿå¦‚ä½•åˆ›å»ºå’Œæä¾›ä¾èµ–é¡¹çš„é…æ–¹ã€‚æä¾›è€…å®šä¹‰äº†å¦‚ä½•æ³¨å†Œå’Œè§£ææœåŠ¡ã€å€¼å’Œå·¥å‚ï¼Œæ— è®ºæ˜¯é€šè¿‡ç±»æ„é€ å‡½æ•°ã€å·¥å‚å‡½æ•°è¿˜æ˜¯é¢„å…ˆå­˜åœ¨çš„å€¼ã€‚

**Injectorï¼ˆæ³¨å…¥å™¨ï¼‰** - é€šè¿‡å°†æ³¨å…¥æ ‡è®°ä¸æä¾›è€…åŒ¹é…æ¥è§£æä¾èµ–é¡¹çš„æ ¸å¿ƒå¼•æ“ã€‚å®ƒç»´æŠ¤ä¾èµ–é¡¹æŸ¥æ‰¾çš„åˆ†å±‚é“¾ï¼Œå……å½“è¿è¡Œæ—¶ä¾èµ–é¡¹è§£ææœºåˆ¶ã€‚

è¿™ä¸‰ä¸ªæ¦‚å¿µååŒå·¥ä½œï¼š**Platform** å‘ **Injector** æ³¨å†Œ **Providers**ï¼Œç„¶ååœ¨è¯·æ±‚æœåŠ¡æ—¶è§£æä¾èµ–é¡¹ã€‚

## å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ æ‹¥æœ‰ï¼š

- **Node.js**ï¼ˆv14.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- **TypeScript**ï¼ˆv4.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- **npm** æˆ– **yarn** åŒ…ç®¡ç†å™¨

:::tip å°è¯•ç¤ºä¾‹
ä½ å¯ä»¥åœ¨æ­¤å­˜å‚¨åº“çš„ [`example/`](https://github.com/isatiso/node-tarpit/tree/main/example) ç›®å½•ä¸­æ‰¾åˆ°å®Œæ•´çš„å·¥ä½œç¤ºä¾‹ï¼ŒæŒ‰æ¨¡å—ç»„ç»‡ã€‚
:::

### å®‰è£…

åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ç›®å½•ï¼š

```bash
mkdir my-tarpit-app
cd my-tarpit-app
```

åˆå§‹åŒ–ä½ çš„é¡¹ç›®ï¼š

```bash
npm init -y
```

å®‰è£… TypeScript å’Œå¼€å‘ä¾èµ–é¡¹ï¼š

```bash
# å…¨å±€å®‰è£… TypeScript æˆ–ä½œä¸ºå¼€å‘ä¾èµ–é¡¹å®‰è£…
npm install -D typescript ts-node @types/node

# åˆå§‹åŒ– TypeScript é…ç½®
npx tsc --init
```

åœ¨ `tsconfig.json` ä¸­é…ç½® TypeScript æ”¯æŒè£…é¥°å™¨ï¼š

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  }
}
```

å®‰è£… Tarpit HTTP æ¨¡å—ï¼ˆåŒ…å«æ ¸å¿ƒä¾èµ–é¡¹ï¼‰ï¼š

```bash
npm install @tarpit/http @tarpit/judge @tarpit/config reflect-metadata
```

:::note ä¸ºä»€ä¹ˆéœ€è¦ reflect-metadataï¼Ÿ
`reflect-metadata` æ˜¯ TypeScript è£…é¥°å™¨å…ƒæ•°æ®åå°„æ‰€å¿…éœ€çš„ã€‚Tarpit çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿä½¿ç”¨å®ƒæ¥è‡ªåŠ¨æ£€æµ‹æ„é€ å‡½æ•°å‚æ•°ç±»å‹å¹¶å¯ç”¨ç±»å‹å®‰å…¨çš„ä¾èµ–é¡¹è§£æã€‚
:::

### Hello World ç¤ºä¾‹

:::info å®Œæ•´ç¤ºä¾‹
[`example/basic/hello-world.ts`](https://github.com/isatiso/node-tarpit/blob/main/example/basic/hello-world.ts)
:::

åˆ›å»º `src/index.ts`ï¼š

```typescript
import { load_config } from '@tarpit/config'
import { Platform, TpConfigSchema } from '@tarpit/core'
import { HttpServerModule, TpRouter, Get, PathArgs } from '@tarpit/http'
import { Jtl } from '@tarpit/judge'

@TpRouter('/')
class HelloRouter {
    
    @Get('hello')
    async say_hello() {
        return { message: 'Hello, Tarpit!' }
    }
    
    @Get('user/:id')
    async get_user(args: PathArgs<{ id: string }>) {
        const user_id = args.ensure('id', Jtl.string)
        return { user_id, name: `User ${user_id}` }
    }
}

const config = load_config<TpConfigSchema>({ 
    http: { port: 4100 } 
})

const platform = new Platform(config)
    .import(HttpServerModule)
    .import(HelloRouter)
    .start()
```

è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºï¼š

```bash
npx ts-node src/index.ts
```

æµ‹è¯•ä½ çš„ç«¯ç‚¹ï¼š

```bash
# åŸºç¡€ hello ç«¯ç‚¹
curl http://localhost:4100/hello

# å‚æ•°åŒ–ç«¯ç‚¹
curl http://localhost:4100/user/123
```

æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ï¼š
- **åŸºç¡€è·¯ç”±**ï¼šä½¿ç”¨ `@TpRouter` å®šä¹‰è·¯ç”±å‰ç¼€
- **HTTP æ–¹æ³•**ï¼šä½¿ç”¨ `@Get` è£…é¥°å™¨å¤„ç† GET ç«¯ç‚¹
- **è·¯å¾„å‚æ•°**ï¼šæå–å’ŒéªŒè¯ URL å‚æ•°
- **JSON å“åº”**ï¼šä»ç«¯ç‚¹è¿”å›ç»“æ„åŒ–æ•°æ®

### æœåŠ¡æ³¨å…¥ç¤ºä¾‹

:::info å®Œæ•´ç¤ºä¾‹
[`example/basic/service-injection.ts`](https://github.com/isatiso/node-tarpit/blob/main/example/basic/service-injection.ts)
:::

å¯¹äºæ›´å¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œä½ ä¼šå¸Œæœ›ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç»„ç»‡ä»£ç ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ HTTP è·¯ç”±åˆ›å»ºå¯æ³¨å…¥æœåŠ¡ï¼š

```typescript
import { load_config } from '@tarpit/config'
import { Platform, TpConfigSchema, TpService } from '@tarpit/core'
import { HttpServerModule, TpRouter, Get, PathArgs } from '@tarpit/http'
import { Jtl } from '@tarpit/judge'

// 1. å£°æ˜ - å°†ç±»æ ‡è®°ä¸ºå¯æ³¨å…¥æœåŠ¡
@TpService()
class DatabaseService {
    connect() {
        console.log('Connected to database')
    }
    
    query(sql: string) {
        console.log(`Executing query: ${sql}`)
        return []
    }
    
    find_user(id: string) {
        console.log(`Finding user with ID: ${id}`)
        return { id, name: `User ${id}`, email: `user${id}@example.com` }
    }
}

@TpService()
class UserService {
    // 2. ä¾èµ–é¡¹å°†è‡ªåŠ¨æ³¨å…¥
    constructor(private db: DatabaseService) {}
    
    create_user(name: string) {
        this.db.connect()
        const result = this.db.query(`INSERT INTO users (name) VALUES ('${name}')`)
        console.log(`Created user: ${name}`)
        return { id: Date.now(), name }
    }
    
    get_user(id: string) {
        this.db.connect()
        return this.db.find_user(id)
    }
}

// 3. ä½¿ç”¨æ³¨å…¥æœåŠ¡çš„ HTTP è·¯ç”±å™¨
@TpRouter('/api/users')
class UserRouter {
    // 4. åœ¨è·¯ç”±å™¨ä¸­è¿›è¡ŒæœåŠ¡æ³¨å…¥
    constructor(private userService: UserService) {}
    
    @Get('')
    async list_users() {
        return { 
            message: 'User list endpoint',
            users: ['Alice', 'Bob', 'Charlie']
        }
    }
    
    @Get(':id')
    async get_user(args: PathArgs<{ id: string }>) {
        const user_id = args.ensure('id', Jtl.string)
        const user = this.userService.get_user(user_id)
        return user
    }
    
    @Get('hello/:name')
    async greet_user(args: PathArgs<{ name: string }>) {
        const name = args.ensure('name', Jtl.string)
        this.userService.create_user(name)
        return { 
            message: `Hello, ${name}!`,
            user: { name, created: true }
        }
    }
}

async function main() {
    // 5. æ³¨å†Œ - å°†æœåŠ¡å’Œè·¯ç”±å™¨æ³¨å†Œåˆ°å¹³å°
    const config = load_config<TpConfigSchema>({ 
        http: { port: 4100 } 
    })

    const platform = new Platform(config)
        .import(HttpServerModule)
        .import(DatabaseService)
        .import(UserService)
        .import(UserRouter)
        
    await platform.start()
    
    console.log('Server started on http://localhost:4100')
    console.log('Try these endpoints:')
    console.log('  GET  http://localhost:4100/api/users')
    console.log('  GET  http://localhost:4100/api/users/123')
    console.log('  GET  http://localhost:4100/api/users/hello/Alice')
}

main().catch(console.error)
```

è¿è¡Œç¤ºä¾‹ï¼š

```bash
npx ts-node example/basic/service-injection.ts
```

æµ‹è¯• API ç«¯ç‚¹ï¼š

```bash
# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
curl http://localhost:4100/api/users

# è·å–ç‰¹å®šç”¨æˆ·
curl http://localhost:4100/api/users/123

# åˆ›å»ºå¹¶é—®å€™ç”¨æˆ·
curl http://localhost:4100/api/users/hello/Alice
```

æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ï¼š
- **æœåŠ¡å£°æ˜**ï¼šä½¿ç”¨ `@TpService()` å°†ç±»æ ‡è®°ä¸ºå¯æ³¨å…¥
- **ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°å‚æ•°è‡ªåŠ¨æ³¨å…¥ä¾èµ–é¡¹
- **è·¯ç”±å™¨æ³¨å…¥**ï¼šå°†æœåŠ¡æ³¨å…¥åˆ° HTTP è·¯ç”±å™¨ä¸­ç”¨äº API ç«¯ç‚¹
- **æœåŠ¡æ³¨å†Œ**ï¼šå°†æœåŠ¡å’Œè·¯ç”±å™¨å¯¼å…¥åˆ°å¹³å°ä¸­
- **HTTP é›†æˆ**ï¼šå°†ä¾èµ–æ³¨å…¥ä¸ REST API ç«¯ç‚¹ç»“åˆ
- **è·¯å¾„å‚æ•°**ï¼šä½¿ç”¨ç±»å‹å®‰å…¨æå–å’ŒéªŒè¯ URL å‚æ•°

## ä¸‹ä¸€æ­¥

å‡†å¤‡æ·±å…¥äº†è§£ï¼Ÿæ¢ç´¢æˆ‘ä»¬çš„ç»¼åˆæ–‡æ¡£ï¼š

### æ ¸å¿ƒæ¡†æ¶
- [**æ ¸å¿ƒæ¦‚å¿µ**](./core/) - äº†è§£ä¾èµ–æ³¨å…¥ã€æä¾›è€…å’Œå¹³å°
- [**å¹³å°ç”Ÿå‘½å‘¨æœŸ**](./core/platform-lifecycle) - ç†è§£åº”ç”¨ç¨‹åºå¯åŠ¨å’Œå…³é—­
- [**ä¾èµ–æ³¨å…¥**](./core/dependency-injection) - é«˜çº§ DI æ¨¡å¼å’Œæœ€ä½³å®è·µ

### HTTP æœåŠ¡å™¨æ¨¡å—
- [**HTTP æœåŠ¡å™¨**](./http/) - Web APIã€è·¯ç”±ã€ä¸­é—´ä»¶å’Œèº«ä»½éªŒè¯
- [**è¯·æ±‚å¤„ç†**](./http/request-handling) - å¤„ç† HTTP è¯·æ±‚å’Œå“åº”
- [**ä¸­é—´ä»¶**](./http/middleware) - è‡ªå®šä¹‰ä¸­é—´ä»¶å’Œè¯·æ±‚å¤„ç†

### å…¶ä»–æ¨¡å—
- [**RabbitMQ æ¨¡å—**](./rabbitmq/) - æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨æ¶æ„
- [**è°ƒåº¦æ¨¡å—**](./schedule/) - Cron ä½œä¸šå’Œåå°ä»»åŠ¡
- [**å†…å®¹ç±»å‹æ¨¡å—**](./content-type/) - å¤„ç†ä¸åŒçš„æ•°æ®æ ¼å¼

:::tip å®Œæ•´ç¤ºä¾‹å­˜å‚¨åº“
è¦è¿›è¡Œå®è·µå­¦ä¹ ï¼Œè¯·æŸ¥çœ‹ [`example/`](https://github.com/isatiso/node-tarpit/tree/main/example) ç›®å½•ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªæ¨¡å—çš„å¯è¿è¡Œä»£ç ç¤ºä¾‹ã€‚
::: 